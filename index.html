<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>JavaCall.jl -- Call Java from Julia</title>

    <link rel="stylesheet" href="res/styles.css">
    <link rel="stylesheet" href="res/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <style TYPE="text/css">
      code.has-jax {font: inherit; font-size: 100%; background: inherit; border: inherit;}
    </style>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          tex2jax: {
              inlineMath: [['$','$'], ['\\(','\\)']],
              skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'header'] // removed 'code' entry
          }
      });
      MathJax.Hub.Queue(function() {
          var all = MathJax.Hub.getAllJax(), i;
          for(i = 0; i < all.length; i += 1) {
              all[i].SourceElement().parentNode.className += ' has-jax';
          }
      });
    </script>  
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>JavaCall.jl</h1>
        <p>Call Java Programs from Julia </p>

        <ul>
          <li><a href="https://github.com/aviks/JavaCall.jl/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/aviks/JavaCall.jl/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/aviks/JavaCall.jl">View On <strong>GitHub</strong></a></li>
        </ul>
        <div class="menu">
        <ul>
           <li><a href="index.html">Home</a></li>
           <li><a href="types.html">Types</a></li>
           <li><a href="methods.html">Methods</a></li>
           <li><a href="gc.html">GC</a></li>
	   <li><a href="reflection.html">Reflection API</a></li>
	   <li><a href="iterators.html">Iterators</a></li>
           <li><a href="faq.html">Troubleshooting and FAQs</a></li>
        </ul>
      </div>
      </header>
      <section>
	<h1 id="call-java-programs-from-julia">Call Java programs from Julia</h1>

<p>The JavaCall package allows calling Java programs from within Julia code. It uses the Java Native Interface (<a href="http://docs.oracle.com/javase/1.5.0/docs/guide/jni/spec/jniTOC.html">JNI</a>) to call into an in-process Java Virtual Machine (JVM). The primary entry point to Java is the <code class="highlighter-rouge">jcall</code> function. This is modeled on the Julia <code class="highlighter-rouge">ccall</code> function, and takes as input the receiver object (or class, for static methods), the method name, the output type, a tuple of the method parameter types, and the parameters themselves.</p>

<p>This package has been tested using Oracle JDK 7, 8 and 9 on MacOSX and Ubuntu on 64 bit environments. It has also been shown to work with <code class="highlighter-rouge">OpenJDK</code> flavour of java. It has also been tested on Windows 64 bit environments. However, it does not work on 32 bit environments. It will not work with the Apple 1.6 JDK since that is a 32 bit JVM, and Julia is typically built as a 64 bit executable on OSX.</p>

<h2 id="installation">Installation</h2>

<div class="language-julia highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="x">(</span><span class="s">"JavaCall"</span><span class="x">)</span>
</code></pre></div></div>

<p>This package has a dependency on the <code class="highlighter-rouge">WinReg</code> package which, on Windows, is used to derive the location of the JDK automatically.</p>

<h2 id="usage">Usage</h2>

<p>Static and instance methods with primitive or object arguments and return values are callable. Array arguments and return values are also supported. Primitive, string, object or array arguments are converted as required.</p>

<pre><code class="language-jlcon">
julia&gt; using JavaCall

julia&gt; JavaCall.init(["-Xmx128M"])

julia&gt; jlm = @jimport java.lang.Math
JavaObject{:java.lang.Math} (constructor with 2 methods))

julia&gt; jcall(jlm, "sin", jdouble, (jdouble,), pi/2)
1.0

julia&gt; jnu = @jimport java.net.URL
JavaObject{:java.net.URL} (constructor with 2 methods)

julia&gt; gurl = jnu((JString,), "http://www.google.com")
JavaObject{:java.net.URL}(Ptr{Void} @0x0000000108ae2aa8)

julia&gt; jcall(gurl, "getHost", JString,())
"www.google.com"

julia&gt; j_u_arrays = @jimport java.util.Arrays
JavaObject{:java.util.Arrays} (constructor with 2 methods)

julia&gt; jcall(j_u_arrays, "binarySearch", jint, (Array{jint,1}, jint), [10,20,30,40,50,60], 40)
3

</code></pre>

<h2 id="usage-from-a-running-jvm">Usage from a running JVM</h2>

<p>Use JNI or JNA to initialize a Julia VM, then call <code class="highlighter-rouge">JavaCall.init_current_vm()</code>. Here’s an example using JNA:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="n">zot</span><span class="o">.</span><span class="na">julia</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.sun.jna.Native</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Julia</span> <span class="o">{</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="nc">Native</span><span class="o">.</span><span class="na">register</span><span class="o">(</span><span class="s">"julia"</span><span class="o">);</span>
        <span class="n">jl_init__threading</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">double</span> <span class="n">bubba</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">random</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">jl_init__threading</span><span class="o">();</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">jl_eval_string</span><span class="o">(</span><span class="nc">String</span> <span class="n">code</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="kt">void</span> <span class="nf">jl_atexit_hook</span><span class="o">(</span><span class="kt">int</span> <span class="n">status</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span> <span class="n">args</span><span class="o">[])</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
        <span class="n">jl_eval_string</span><span class="o">(</span><span class="s">"println(\"test from Julia\")"</span><span class="o">);</span>
        <span class="n">jl_eval_string</span><span class="o">(</span><span class="s">"using JavaCall"</span><span class="o">);</span>
        <span class="n">jl_eval_string</span><span class="o">(</span><span class="s">"JavaCall.init_current_vm()"</span><span class="o">);</span>
        <span class="n">jl_eval_string</span><span class="o">(</span><span class="s">"println(\"initialized VM\")"</span><span class="o">);</span>
        <span class="n">jl_eval_string</span><span class="o">(</span><span class="s">"jlm = @jimport java.lang.Math"</span><span class="o">);</span>
        <span class="n">jl_eval_string</span><span class="o">(</span><span class="s">"println(jcall(jlm, \"sin\", jdouble, (jdouble,), pi/2))"</span><span class="o">);</span>
        <span class="n">jl_eval_string</span><span class="o">(</span><span class="s">"jl = @jimport zot.julia.Julia"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Bubba should be "</span> <span class="o">+</span> <span class="n">bubba</span><span class="o">);</span>
        <span class="n">jl_eval_string</span><span class="o">(</span><span class="s">"println(\"bubba: \", jfield(jl, \"bubba\", jdouble))"</span><span class="o">);</span>
        <span class="n">jl_eval_string</span><span class="o">(</span><span class="s">"println(\"Done with tests\")"</span><span class="o">);</span>
        <span class="n">jl_atexit_hook</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h2 id="major-todos-and-caveats">Major TODOs and Caveats</h2>

<ul>
  <li>
    <p>Currently, only a low level interface is available, via <code class="highlighter-rouge">jcall</code>. As a result, this package is best suited for writing libraries that wrap around existing java packages. Writing user code direcly using this interface might be a bit tedious at present. A high level interface using reflection will eventually be built.</p>
  </li>
  <li>
    <p>While basic memory management has been implemented, there is the possibility of some remaining memory leaks in this system. While this is stable enough for scripting style tasks, please test thoroughly before deploying this to long running tasks.</p>
  </li>
</ul>

<h3 id="non-windows-operating-systems-linux-macos-freebsd">Non-Windows Operating Systems (Linux, MacOS, FreeBSD)</h3>

<ul>
  <li>
    <p>JavaCall, (and other projects that depend on it, such as JDBC and Spark) do not work on Julia versions 1.1 or 1.2, when using JDK versions less than 11.</p>
  </li>
  <li>
    <p>On Julia 1.3 onwards, set the environment variable <code class="highlighter-rouge">JULIA_COPY_STACKS=yes</code> before starting Julia in order to use JavaCall. Setting this option is required to use JavaCall in the REPL. Using this environment variable does makes multithreading slightly slower in Julia.</p>
  </li>
  <li>
    <p>Setting <code class="highlighter-rouge">JULIA_COPY_STACKS=yes</code> in startup.jl will not work. It must be set before Julia starts. On *nix based systems, this can be done from the shell by using <code class="highlighter-rouge">$ JULIA_COPY_STACKS=yes julia</code> from a shell.</p>
  </li>
  <li>
    <p>JavaCall can be used in a limited capacity from the root <code class="highlighter-rouge">Task</code> of Julia without <code class="highlighter-rouge">JULIA_COPY_STACKS=yes</code>. For example, using JavaCall in a programfile or via <code class="highlighter-rouge">julia --eval</code> will work. However, JavaCall will not function with <code class="highlighter-rouge">@async</code> or the standard REPL backend.</p>
  </li>
  <li>
    <p>Alternatively, Julia 1.0.x works with all versions of Java.</p>
  </li>
</ul>

<h3 id="windows-operating-system">Windows Operating System</h3>

<ul>
  <li>
    <p>Do not set the environmental variable <code class="highlighter-rouge">JULIA_COPY_STACKS</code></p>
  </li>
  <li>
    <p>To use <code class="highlighter-rouge">@async</code> with JavaCall, start JavaCall on the root Task when running Julia:
```
$ julia -i -e “using JavaCall; JavaCall.init()”</p>
  </li>
</ul>

      </section>
      <footer>
        <p></p>
        <p><small>This project is maintained by <a href="http://www.sengupta.net/musings/">Avik Sengupta</a>. <br /> Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="res/scale.fix.js"></script>
    <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-37085988-1");
            pageTracker._trackPageview();
            } catch(err) {}
    </script>
  </body>
</html>
